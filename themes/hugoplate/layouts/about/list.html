{{ define "main" }}
  <section class="section-sm">
    <div class="container">
      <!-- 头部信息 -->
      <div class="row justify-center">
        <div class="md:col-10 lg:col-7 text-center">
          {{ partial "image" (dict "Src" .Params.image "Context" .Page "Alt" .Title "Class" "mx-auto mb-6" "Size" "200x0") }}
          <h2 class="h3 mb-6">{{ .Title }}</h2>
        </div>
      </div>
      
      <!-- 文章布局容器 -->
      <div class="article-layout-container">
        <div class="article-layout-wrapper">
          <!-- 移动端 TOC -->
          <div class="toc-mobile">
            {{ if .TableOfContents }}
            <div class="toc-mobile-wrapper">
              <button class="toc-mobile-toggle" onclick="toggleMobileTOC()">
                <span class="flex items-center">
                  <i class="fa-solid fa-list mr-2"></i>
                  <span>目录</span>
                </span>
                <i class="fa-solid fa-chevron-down toggle-icon"></i>
              </button>
              <div class="toc-mobile-content hidden">
                {{ .TableOfContents }}
              </div>
            </div>
            {{ end }}
          </div>

          <!-- 主要内容网格 -->
          <div class="article-content-grid">
            <!-- 左侧：文章内容 -->
            <article class="article-main-content">
              <div class="content">
                {{ .Content }}
              </div>
            </article>

            <!-- 右侧：浮动 TOC -->
            {{ if .TableOfContents }}
            <aside class="article-toc-sidebar">
              <div class="toc-sticky-wrapper">
                <h4 class="toc-title">目录</h4>
                <nav class="toc-nav">
                  {{ .TableOfContents }}
                </nav>
              </div>
            </aside>
            {{ end }}
          </div>
        </div>
      </div>
    </div>
  </section>

  <script>
    function toggleMobileTOC() {
      const content = document.querySelector('.toc-mobile-content');
      const icon = document.querySelector('.toggle-icon');
      if (content && icon) {
        content.classList.toggle('hidden');
        icon.classList.toggle('rotate-180');
      }
    }

    // 高亮当前章节
    document.addEventListener('DOMContentLoaded', function() {
      const observer = new IntersectionObserver(entries => {
        entries.forEach(entry => {
          const id = entry.target.getAttribute('id');
          if (entry.intersectionRatio > 0) {
            document.querySelectorAll('.toc-nav a').forEach(link => {
              link.classList.remove('active');
            });
            const activeLink = document.querySelector(`.toc-nav a[href="#${id}"]`);
            if (activeLink) {
              activeLink.classList.add('active');
            }
          }
        });
      }, { rootMargin: '-20% 0% -35% 0%' });

      document.querySelectorAll('h1[id], h2[id], h3[id], h4[id], h5[id], h6[id]').forEach(section => {
        observer.observe(section);
      });
    });
  </script>
{{ end }}
